El shell Bash

MacProgramadores

Ejercicio 4.2
En el mundo de GNU existen unas herramientas llamadas NetPBM1 que
permiten convertir entre muchos formatos gráficos. La herramienta suele
convertir de formatos conocidos (gif, bmp, jpg) a un formato interno, o bien
del formato interno a los formatos conocidos. Los formatos internos que
utiliza son .ppm (Portable Pixel Map) para imágenes en color, .pgm (Portable
Gray Map) para imágenes en escala de grises, y .pbm (Portable Bit Map) para
imágenes formadas por bits de blanco y negro. A veces estos formatos
aparecen bajo la extensión general .pnm, que abarca a todos ellos.
Nuestro objetivo es hacer un script llamado bmptojpg que reciba uno o dos
nombres de fichero, el primero de tipo .bmp y el segundo de tipo .jpg. Si no
se suministra el segundo argumento, el nombre del fichero será el mismo que
el del primer argumento pero con la extensión .jpg. Para realizar las
conversiones usaremos los comandos de NetPBM bmptoppm y ppmtojpeg.
Los comandos reciben como argumento el fichero origen y emiten por la
salida estándar el fichero en el formato destino.
Para obtener el primer argumento, o dar error si no se nos suministra,
podemos usar el operador :? así:
fichero_entrada=${1:?'falta argumento'}
Para obtener los nombres de fichero intermedio y de salida usamos:
fichero_intermedio=${fichero_entrada%.bmp}.ppm
fichero_salida=${2:-${fichero_intermedio%.ppm}.jpg}
Obsérvese que para el nombre de salida usamos el operador :- para que si
no se ha suministrado el segundo argumento usemos el nombre del fichero
de entrada, pero con la extensión cambiada.
Luego el script que realiza esta operación se muestra en el Listado 4.10.
# Convierte un .bmp en un .jpg
fichero_entrada=${1:?'falta argumento'}
fichero_intermedio=${fichero_entrada%.bmp}.ppm
fichero_salida=${2:-${fichero_intermedio%.ppm}.jpg}
bmptoppm $fichero_entrada > $fichero_intermedio
ppmtojpeg $fichero_intermedio > $fichero_salida
Listado 4.10: Script que convierte un .bmp en un .jpg

1

El paquete se encuentra en http://netpbm.sourceforge.net. En el caso de Mac OS X puede
descargarlo directamente del proyecto Fink.
Pág 61

