El shell Bash

MacProgramadores

# Script que convierte ficheros de imagen al formato .jpg
# Lee las opciones
while getopts ":s:b:" opt
do
case $opt in
s ) escala=$OPTARG;;
b ) grosor=$OPTARG;;
\?) echo "Use: tojpg [-s escala] " \
"[-b grosorborde] ficheros..."
exit 1;;
esac
done
shift $(($OPTIND -1))
for fichero in $@
do
# Convierte a .ppm
fichero_ppm=${fichero%.*}.ppm
case $fichero in
*.jpg) exit 0;;
*.tga) tgatoppm $fichero > $fichero_ppm;;
*.xpm) xpmtoppm $fichero > $fichero_ppm;;
*.pcx) pcxtoppm $fichero > $fichero_ppm;;
*.tif) tifftopnm $fichero > $fichero_ppm;;
*.gif) figtoppm $fichero > $fichero_ppm;;
*.pnm|*.ppm) ;;
*) echo "Formato .${fichero##*.} no soportado"
exit 1;;
esac
# Aplica las opciones
if [ $escala ]; then
cp $fichero_ppm aux.$fichero_ppm
pnmscale $escala aux.$fichero_ppm > $fichero_ppm
rm aux.$fichero_ppm
fi
if [ $grosorborde ]; then
cp $fichero_ppm aux.$fichero_ppm
pnmmargin $grosor aux.$fichero_ppm > $fichero_ppm
rm aux.$fichero_ppm
fi
# Genera el fichero final
fichero_salida=${fichero_ppm%.ppm}.jpg
pnmtojpeg $fichero_ppm > $fichero_salida
if ! [ $fichero = $fichero_ppm ]; then
rm $fichero_ppm
fi
done
Listado 6.1: Script que usa opciones para procesar imágenes

Pág 92

