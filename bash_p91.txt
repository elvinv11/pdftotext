El shell Bash

MacProgramadores

cmd:getopts:illegal option si pasamos una opción no válida. El
símbolo : delante de la cadena de opciones se usa para evitar que getopts
produzca un mensaje de error si recibe una opción inválida. Lo que sí que
ocurre es que al recibir una opción inválida la variable opt se queda valiendo
?, y se ejecuta el caso que informa al usuario del error. Obsérvese que ? está
precedido por el carácter de escape debido a que es un carácter especial que
no queremos que se interprete como parte del patrón.
Obsérvese también que no hacemos shift dentro del bucle ya que getopts
es lo suficientemente inteligente como para devolvernos cada vez una opción
distinta. Lo que sí hemos hecho al final del bucle es desplazar tantas veces
como argumentos con opciones hayamos encontrado. Para ello getopts
almacena en la variable de entorno OPTIND el número del primer argumento
a procesar. Por ejemplo en hacer -ab esto.txt la variable $OPTIND
valdrá 3, y en hacer -a -b esto.txt la variable $OPTIND valdrá 4. La
expresión $(($OPTIND -1)) es una expresión aritmética (que veremos en
breve en este tema).
Ejercicio 6.1
Mejorar el script tojpg del Ejercicio 5.4 para que tenga la posibilidad de
redimensionar imágenes y de ponerlas borde. Para ello el comando pasará a
tener el siguiente formato:
tojpg [-s escala] [-b grosorborde] ficheros...
Para realizar este ejercicio puede utilizar dos nuevos comandos de NetPBM: El
primero es el comando ppmscale, el cual tiene la sintaxis:
pnmscale scale files...
Que escala las imágenes en el factor que diga scale (p.e. si scale es 2
aumenta su tamaño al doble).
El otro comando es:
pnmmargin borderwidth files...
El cual pone un borde del grosor borderwidth a la imagen.
El Listado 6.1 muestra la solución propuesta. Usando getopts almacenamos
en las variables escala y grosor los valores de estas opciones. Si estos
valores no se proporcionan las variables quedan vacías y durante la ejecución
del bucle for principal no se tendrá en cuenta esta opción.

Pág 91

